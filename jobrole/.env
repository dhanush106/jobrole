VITE_GOOGLE_CLIENT_ID=677219864654-vut2tlu52rsn8jjbvv4lg3mk2544uvmp.apps.googleusercontent.com
import { useEffect, useState } from "react";
import { useNavigate, Link } from "react-router-dom";
import axios from "./axios";
import "./login.css";

function Login() {
  const [form, setForm] = useState({ email: "", password: "" });
  const navigate = useNavigate();

  // -------------------------------
  // EMAIL/PASSWORD LOGIN
  // -------------------------------
  const handleLogin = async (e) => {
    e.preventDefault();
    try {
      const res = await axios.post("/auth/login", form);
      localStorage.setItem("token", res.data.token);
      navigate("/dashboard");
    } catch (err) {
      alert(err.response?.data?.message || "Login failed");
    }
  };

  // -------------------------------
  // GOOGLE LOGIN
  // -------------------------------
  const handleGoogleLogin = () => {
    if (!window.googleSDKReady) {
      alert("Please wait… Google login is still loading");
      return;
    }

    window.google.accounts.id.initialize({
      client_id: import.meta.env.VITE_GOOGLE_CLIENT_ID,
      callback: async (response) => {
        try {
          const res = await axios.post("/auth/google-login", {
            token: response.credential,
          });
          localStorage.setItem("token", res.data.token);
          navigate("/dashboard");
        } catch (error) {
          alert("Google login failed");
        }
      },
    });

    // Display the One Tap prompt
    window.google.accounts.id.prompt();
  };

  // -------------------------------
  // LOAD GOOGLE SDK
  // -------------------------------
  useEffect(() => {
    const script = document.createElement("script");
    script.src = "https://accounts.google.com/gsi/client";
    script.async = true;
    script.onload = () => {
      window.googleSDKReady = true;
    };
    document.body.appendChild(script);
  }, []);

  // -------------------------------
  // JSX
  // -------------------------------
  return (
    <div className="auth-page">
      <div className="auth-container">

        {/* LEFT PANEL - LOGIN FORM */}
        <form onSubmit={handleLogin} className="login-box">
          <h2>Login</h2>

          <input
            placeholder="Email"
            onChange={(e) => setForm({ ...form, email: e.target.value })}
          />

          <input
            type="password"
            placeholder="Password"
            onChange={(e) => setForm({ ...form, password: e.target.value })}
          />

          <button type="submit" className="login-btn">Login</button>

          {/* GOOGLE LOGIN BUTTON */}
          <button
            type="button"
            className="google-btn"
            onClick={handleGoogleLogin}
          >
            <img
              src="https://developers.google.com/identity/images/g-logo.png"
              alt="Google"
            />
            Sign in with Google
          </button>

          <p>
            Don’t have an account? <Link to="/signup">Signup</Link>
          </p>
        </form>

        {/* RIGHT PANEL */}
        <div className="right-panel">
          <h2>Welcome Back!</h2>
          <p>Don’t have an account?</p>

          <Link to="/signup">
            <button className="panel-btn">Signup</button>
          </Link>
        </div>

      </div>
    </div>
  );
}

export default Login;
